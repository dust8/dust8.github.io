<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
    
  
  <link href="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.lug.ustc.edu.cn/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






  

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/assert/avatar.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/assert/avatar.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/assert/avatar.png?v=5.1.4">


  <link rel="mask-icon" href="/assert/avatar.png?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="Dust8 的博客" type="application/atom+xml">






<meta name="description" content="读书百遍其义自见">
<meta property="og:type" content="website">
<meta property="og:title" content="Dust8 的博客">
<meta property="og:url" content="https://dust8.github.io/blog/page/12/index.html">
<meta property="og:site_name" content="Dust8 的博客">
<meta property="og:description" content="读书百遍其义自见">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dust8 的博客">
<meta name="twitter:description" content="读书百遍其义自见">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://dust8.github.io/blog/page/12/">





  <title>Dust8 的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Dust8 的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">读书百遍其义自见</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dust8.github.io/blog/2017/02/16/speech-to-text-use-python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dust8">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dust8 的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/16/speech-to-text-use-python/" itemprop="url">使用python来语音转文字</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-16T05:15:31+00:00">
                2017-02-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天在 <em>youtube</em> 上看到 <a href="https://www.youtube.com/watch?v=31DZfkYRvI4" target="_blank" rel="noopener">[Open Jarvis] 如何讓Python 自動將語音轉譯成文字?</a>, 就想到前段时间想<br>把没有字幕的视频里面的语音转成文字, 这样好理解一些(英语渣的苦,谁渣谁知道).<br>找了半天都是要申请 <em>api key</em> 还有各种限制, 比如收费(哈哈).</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="ffmpeg"><a href="#ffmpeg" class="headerlink" title="ffmpeg"></a>ffmpeg</h3><p>官网: <a href="http://ffmpeg.org/" target="_blank" rel="noopener">http://ffmpeg.org/</a><br>这里用它来提取视频里面的音频.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install ffmpeg</span><br></pre></td></tr></table></figure></p>
<h3 id="SpeechRecognition"><a href="#SpeechRecognition" class="headerlink" title="SpeechRecognition"></a>SpeechRecognition</h3><p><a href="https://pypi.python.org/pypi/SpeechRecognition/" target="_blank" rel="noopener">SpeechRecognition</a><br>它是把在线的,离线的,各种aip接口集合在一起,然后提供统一的接口.<br>因为我不喜欢要申请key的,所以只能用离线的 <em>CMU Sphinx</em>.</p>
<p>先去 <a href="http://cmusphinx.sourceforge.net/wiki/download" target="_blank" rel="noopener">CMUSphinx</a>下载安装 <em>sphinxbase</em> <em>pocketsphinx</em>, 可以看 <a href="https://github.com/cmusphinx/pocketsphinx" target="_blank" rel="noopener">cmusphinx/pocketsphinx</a>.<br>在安装它们之前还要安装 <em>swig</em>,不然会报错.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install swig</span><br></pre></td></tr></table></figure></p>
<p>都安装好后在<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pocketsphinx</span><br></pre></td></tr></table></figure></p>
<h2 id="提取音频"><a href="#提取音频" class="headerlink" title="提取音频"></a>提取音频</h2><p>比如我要提取 <a href="https://www.destroyallsoftware.com/screencasts" target="_blank" rel="noopener">das-0091-introduction-to-computation-4k.mp4</a> 的音频为 <em>test.wav</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i das-0091-introduction-to-computation-4k.mp4 -vn test.wav</span><br></pre></td></tr></table></figure></p>
<p>因为 <em>AudioFile</em> 接口只支持 <em>WAV/AIFF/FLAC</em>, 所以用的是 <em>wav</em>.</p>
<h2 id="提取文字"><a href="#提取文字" class="headerlink" title="提取文字"></a>提取文字</h2><p>可以看官方的例子 <a href="https://github.com/Uberi/speech_recognition/blob/master/examples/audio_transcribe.py" target="_blank" rel="noopener">audio_transcribe.py</a> 很简单.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> speech_recognition <span class="keyword">as</span> sr</span><br><span class="line"></span><br><span class="line">r = sr.Recognizer()</span><br><span class="line"><span class="keyword">with</span> sr.AudioFile(<span class="string">'test.wav'</span>) <span class="keyword">as</span> source:</span><br><span class="line">    audio = r.record(source)</span><br><span class="line"></span><br><span class="line">r.recognize_sphinx(audio)</span><br></pre></td></tr></table></figure></p>
<p>输出如下:    </p>
<blockquote>
<p>this series is going to cover competition and i think we should begin by just laying out the topics are going to mention along the way so we have a sense of where we’re going the first of those topics is the radical simplicity of computation it turns out that all the complexity of our computers and programming languages and operating systems is comp complexity that we have added it is not fundamental to computation and to see that we’re going to look both at the turn machine and abby lana calculus which are the two most well known models of computation were these the two most well known abstract models both of these are normally talk with the very mathematical kind of terminology indication lot of greek letters and so on but we’re just going to use python code because python is aline was any programmer can understand pretty easily and that wall hours to get at least a high level understanding of what’s going on inside of the systems the next topic that we’re going to talk about is the limits of computation specifically be holding problem which is an example of an undesirable problem at the computer science be holding problems as they did really quickly is the problem of writing a function let’s call a halt it takes another function of scott after the decides whether half will terminate we’re not itself will terminate eventually then hold your return troops itself wolford sample would forever than a halt to return faults and it’s easy to state that problem as i just did it but you cannot write this launch and no programming language can express this function no computational system can express his function at the highly non obvious result but there are rigorous mathematical proof so this going back to the nineteen thirty’s and they have held up for a year’s both in theory and practice so will see why that’s true are these the high level sketch of why that’s true and some of the implications of it for the rest of computation we’re also going to see the structure of computation specifically the idea of trying equivalents which tells us that the turing machine and amanda calculus are both capable of answering the same questions any question that one of them can answer the other cancer and it turns out to this is true of our real world computers as well including the laptop and i’m recording this on if my laptop unanswered question and so could turn machine and this is extremely surprising given how simple turn machines are exactly first look at them you’re not going to believe that their actual general purpose computer system but it turns out that in fact they are because of turner problems which once again as a rigorous mathematical proof is going back to the nineteen eighties excuse me hit eighty years ago the nineteen thirty’s a related idea that will talk about is the chon ski hierarchy of computational systems and it turns out that this turn of quo blood type of system is only the most powerful type of computation there are four levels and as hierarchy and they began with the weakest which is a bullet to what we called regular depressions the next level is what you would need if you wanted to recognize python code mi you want to decide whether as spring is valid python or is not about python the next levels which would need if you wanted to recognize as c. plus plus code and this distinction is very important in fact python was intentionally designed to require less complexity in the top additional system that recognizes that most programming languages have this level of complex including for example a job as script and one of the reasons the python is so we see the lord and revisit potentially was designed to require less complexity finally the last level in this hierarchy is the turner problem level which contains trainers shane solana calculus my laptop and so on and this hierarchy is first of all amazing just as relates these things that seem unrelated if you haven’t learned as yet but that’s not even the most amazing thing about it the most amazing thing is it known tom speed created this hierarchy when he was studying linguistics he was studying natural languages like english and he establishes different levels of linguistic complexity which computer scientists then took the news for all kinds of things including programming languages but also categorizing finite state machines which fall into these different categories in different ways and will see all of these things are more detail as we go that’s all i want to say about this introduction next time we’re going to pick up trade machines were gonna ride that simulator that could be wrapped hemlines a code and take about ten minutes of soul be quite easy to write so i’ll see you next time for training sheets</p>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>例子很简单,主要时间花在安装包上面,提取出来的文字虽然还有错误, 但大体意思还是不难理解的.不知道其他在线的接口的效果怎么样,我个人觉得正确率应该会高些,有兴趣的可以自己试下.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dust8.github.io/blog/2017/02/09/html-and-css-note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dust8">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dust8 的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/09/html-and-css-note/" itemprop="url">《HTML & CSS Design and Build Websites》读后感</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-09T05:15:31+00:00">
                2017-02-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近过了一遍《HTML &amp; CSS Design and Build Websites》.这本书对初学者比较友好,<br>图文并茂,排版美观,内容全面,是一本值得一看的书.主要是自学的,不懂的就搜索,没有完整的看过一遍,看这本书主要是看看有哪些漏下的,还有就是顺便复习一下.<br>这里推荐一个css可视化的参考网站,里面用图文来解释css的属性,非常直观: <a href="http://cssreference.io/" target="_blank" rel="noopener">css reference</a>.</p>
<h2 id="一些知识"><a href="#一些知识" class="headerlink" title="一些知识"></a>一些知识</h2><h3 id="颜色"><a href="#颜色" class="headerlink" title="颜色"></a>颜色</h3><h4 id="色调"><a href="#色调" class="headerlink" title="色调"></a>色调</h4><p>差不多就是颜色.</p>
<h4 id="色环"><a href="#色环" class="headerlink" title="色环"></a>色环</h4><p>就是把颜色环成一个圆圈,每一个角度对应一个色调.</p>
<h4 id="饱和度"><a href="#饱和度" class="headerlink" title="饱和度"></a>饱和度</h4><p>是指一种色调中灰色的含量,用百分比来表示.100%的饱和度代表不加入灰色.同样0%的饱和度就全是灰色了.</p>
<h4 id="亮度"><a href="#亮度" class="headerlink" title="亮度"></a>亮度</h4><p>是指色调中加入黑色的含量.亮度最大时就是该色调,亮度最小时就是黑色了.</p>
<h4 id="明度"><a href="#明度" class="headerlink" title="明度"></a>明度</h4><p>是指色调中加入白色或者黑色的含量.明度为0%时是黑色,50%时是标准色,100%时是白色.</p>
<h3 id="line-height"><a href="#line-height" class="headerlink" title="line-height"></a>line-height</h3><p>行间距就是2行直接的距离.在css中有一点不一样, <em>line-height</em> 指的是字体大小再加行间距. 这就是 <em>line-height</em> 和 <em>font-size</em> 的区别.推荐用 <em>1.4em</em> 到 <em>1.5em</em>,这样可以提高文本的可读性.</p>
<h3 id="vertical-align"><a href="#vertical-align" class="headerlink" title="vertical-align"></a>vertical-align</h3><p>垂直对齐.比如说, 要实现顶部对齐就可以设置 <em>vertical-align: top</em>.</p>
<h3 id="自定义text-inputs-的格式"><a href="#自定义text-inputs-的格式" class="headerlink" title="自定义text inputs 的格式"></a>自定义text inputs 的格式</h3><p>比如说给它前面加个图标:</p>
<ul>
<li>设置 <em>background-image</em>, <em>background-repeat:no-repeat</em>, <em>background-postion</em>,<br>这样图标就在 input 里面了</li>
<li>设置 <em>padding-left</em>, 这样就可以不让图标盖住了输入的数据</li>
</ul>
<h3 id="960-栅格"><a href="#960-栅格" class="headerlink" title="960 栅格"></a>960 栅格</h3><p>因为以前大部分设备显示都大于 960px, 所以选960px来显示内容.在把960px<br>分成12列,每一列是 80px, 这个80px的列包含左右各有10px的间隔,设置width<br>的时候就可以把内容设置为几个列的宽度.比如说, 一列放置3个内容,那么每个内容就<br>占4个列, <em>80(一个列的宽度)</em>4-10(一个间隔的宽度)<em>2</em> 就是每个内容块的宽度,<br>所以每个内容块的宽度就是 <em>300px</em> .这样就可以使得整个页面非常整洁.</p>
<h3 id="线框图"><a href="#线框图" class="headerlink" title="线框图"></a>线框图</h3><p>是指网站中每个页面内容的概要.显示出信息的层次结构以及需要占用的空间.在写代码前<br>画下线框图能更省时间,这样也能更好的分离任务,一次只关注一点,效率才高.</p>
<h3 id="seo"><a href="#seo" class="headerlink" title="seo"></a>seo</h3><h3 id="站内优化"><a href="#站内优化" class="headerlink" title="站内优化"></a>站内优化</h3><ul>
<li>页面标题, <code>&lt;title&gt;&lt;/title&gt;</code></li>
<li>url</li>
<li>标题, <code>&lt;h1&gt;</code> 到 <code>&lt;h6&gt;</code></li>
<li>正文</li>
<li>链接文本</li>
<li>图像的alt属性</li>
<li>页面描述</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dust8.github.io/blog/2017/02/02/unsplash-crawler-and-data-analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dust8">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dust8 的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/02/unsplash-crawler-and-data-analysis/" itemprop="url">unsplash爬虫与数据分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-02T05:15:31+00:00">
                2017-02-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p><em>unsplash</em> 网站比较慢, 只爬数据就用了30分钟, 爬了945页,每页有24条数据. 尝试下载图片,更加慢, 平均每张图片大约10M, 如果要下载完全部图片大约要 <em>945</em>24<em>10/1024 = 222G</em>, 还是算了吧.</p>
<h2 id="爬虫代码"><a href="#爬虫代码" class="headerlink" title="爬虫代码"></a>爬虫代码</h2><p>根据  <a href="https://github.com/aosabook/500lines/tree/master/crawler" target="_blank" rel="noopener">aosabook/500lines</a> 的爬虫修改而来, 尝试使用异步来写爬虫.<br>使用chrome浏览器开发工具来分析入口,在 network 里面的 xhr 就可以看到了, 还可以看到请求的头部,因为该网站需要 <em>authorization</em> 才可以爬取.</p>
<p>crawl.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> crawling</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    crawler = crawling.Crawler()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        loop.run_until_complete(crawler.crawl())</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        print(<span class="string">'\nInterrupted\n'</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        crawler.report()</span><br><span class="line">        crawler.close()</span><br><span class="line"></span><br><span class="line">        loop.stop()</span><br><span class="line">        loop.run_forever()</span><br><span class="line">        loop.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">        main()</span><br></pre></td></tr></table></figure></p>
<p>crawling.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">from</span> db <span class="keyword">import</span> insert_many</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_redirect</span><span class="params">(response)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> response.status <span class="keyword">in</span> (<span class="number">300</span>, <span class="number">301</span>, <span class="number">301</span>, <span class="number">303</span>, <span class="number">307</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Crawler</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,</span></span></span><br><span class="line"><span class="function"><span class="params">                 max_redirect=<span class="number">10</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 max_tries=<span class="number">4</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 max_tasks=<span class="number">10</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 *,</span></span></span><br><span class="line"><span class="function"><span class="params">                 loop=None)</span>:</span></span><br><span class="line">        self.max_redirect = max_redirect</span><br><span class="line">        self.max_tries = max_tries</span><br><span class="line">        self.max_tasks = max_tasks</span><br><span class="line">        self.loop = loop <span class="keyword">or</span> asyncio.get_event_loop()</span><br><span class="line"></span><br><span class="line">        self.q = asyncio.Queue(loop=self.loop)</span><br><span class="line">        self.seen_urls = set()</span><br><span class="line">        self.session = aiohttp.ClientSession(loop=self.loop)</span><br><span class="line">        self.headers = &#123;</span><br><span class="line">            <span class="string">'authorization'</span>:</span><br><span class="line">            <span class="string">'Client-ID d69927c7ea5c770fa2ce9a2f1e3589bd896454f7068f689d8e41a25b54fa6042'</span></span><br><span class="line">        &#125;</span><br><span class="line">        self.base_url = <span class="string">'https://unsplash.com/napi/photos?per_page=24&amp;order_by=latest&amp;page=%s'</span></span><br><span class="line">        self.page = <span class="number">1</span></span><br><span class="line">        self.add_url(self.base_url % (<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">        self.t0 = <span class="literal">None</span></span><br><span class="line">        self.t1 = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_url</span><span class="params">(self, url, max_redirect=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> max_redirect <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            max_redirect = self.max_redirect</span><br><span class="line">        self.seen_urls.add(url)</span><br><span class="line">        self.q.put_nowait((url, max_redirect))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">crawl</span><span class="params">(self)</span>:</span></span><br><span class="line">        workers = [</span><br><span class="line">            asyncio.Task(self.work(), loop=self.loop)</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> range(self.max_tasks)</span><br><span class="line">        ]</span><br><span class="line">        self.t0 = time.time()</span><br><span class="line">        <span class="keyword">await</span> self.q.join()</span><br><span class="line">        self.t1 = time.time()</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> workers:</span><br><span class="line">            w.cancel()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">report</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'total time: '</span>, self.t1 - self.t0)</span><br><span class="line">        print(<span class="string">'total page:'</span>, self.page)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">work</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                url, max_redirect = <span class="keyword">await</span> self.q.get()</span><br><span class="line">                <span class="keyword">await</span> self.fetch(url, max_redirect)</span><br><span class="line">                self.q.task_done()</span><br><span class="line">        <span class="keyword">except</span> asyncio.CancelledError:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">fetch</span><span class="params">(self, url, max_redirect)</span>:</span></span><br><span class="line">        tries = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> tries &lt; self.max_tries:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                response = <span class="keyword">await</span> self.session.get(</span><br><span class="line">                    url, headers=self.headers, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> aiohttp.ClientError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            tries += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># all tries failed.</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> is_redirect(response):</span><br><span class="line">                location = response.headers[<span class="string">'location'</span>]</span><br><span class="line">                next_url = urllib.parse.urljoin(url, location)</span><br><span class="line">                <span class="keyword">if</span> next_url <span class="keyword">in</span> self.seen_urls:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">if</span> max_redirect &gt; <span class="number">0</span>:</span><br><span class="line">                    self.add_url(next_url, max_redirect - <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                links = <span class="keyword">await</span> self.parse_links(response)</span><br><span class="line">                <span class="keyword">for</span> link <span class="keyword">in</span> links.difference(self.seen_urls):</span><br><span class="line">                    self.q.put_nowait((link, self.max_redirect))</span><br><span class="line">                self.seen_urls.update(links)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="keyword">await</span> response.release()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">parse_links</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        links = set()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> response.status == <span class="number">200</span>:</span><br><span class="line">            data = <span class="keyword">await</span> response.json()</span><br><span class="line">            <span class="keyword">if</span> data:</span><br><span class="line">                insert_many(data)</span><br><span class="line">                self.page += <span class="number">1</span></span><br><span class="line">                print(<span class="string">'next'</span>, self.base_url % (self.page))</span><br><span class="line">                links.add(self.base_url % (self.page))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> links</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.session.close()</span><br></pre></td></tr></table></figure></p>
<p>请求回来的数据比较乱，还是用 mongdb 存储比较方便<br>db.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient()</span><br><span class="line">db = client.unsplash</span><br><span class="line">photo = db.photo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert_many</span><span class="params">(photos)</span>:</span></span><br><span class="line">    photo.insert_many(photos)</span><br></pre></td></tr></table></figure></p>
<h2 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a>数据分析</h2><h3 id="提取数据"><a href="#提取数据" class="headerlink" title="提取数据"></a>提取数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient()</span><br><span class="line">db = client.unsplash</span><br><span class="line">photo = db.photo</span><br><span class="line">photos = []</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> photo.find():</span><br><span class="line">    photos.append(p)</span><br></pre></td></tr></table></figure>
<h3 id="数据总量"><a href="#数据总量" class="headerlink" title="数据总量"></a>数据总量</h3><pre><code>len(photos)  

22648
</code></pre><h3 id="定义常用函数"><a href="#定义常用函数" class="headerlink" title="定义常用函数"></a>定义常用函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_counts</span><span class="params">(sequence)</span>:</span></span><br><span class="line">    counts = defaultdict(int)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> sequence:</span><br><span class="line">        counts[x] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> counts</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">top_counts</span><span class="params">(count_dict, n=<span class="number">10</span>)</span>:</span></span><br><span class="line">    value_key_pairs = [(count, key) <span class="keyword">for</span> key, count <span class="keyword">in</span> count_dict.items()]</span><br><span class="line">    value_key_pairs.sort()</span><br><span class="line">    value_key_pairs_n = value_key_pairs[-n:]</span><br><span class="line">    value_key_pairs_n.sort(reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> value_key_pairs_n</span><br></pre></td></tr></table></figure>
<h3 id="top10-图片大小"><a href="#top10-图片大小" class="headerlink" title="top10 图片大小"></a>top10 图片大小</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">width_heights = [str(p[<span class="string">'width'</span>])+<span class="string">'_'</span>+str(p[<span class="string">'height'</span>]) <span class="keyword">for</span> p <span class="keyword">in</span> photos]</span><br><span class="line">width_heights_counts = get_counts(width_heights)</span><br><span class="line">print(len(width_heights_counts))</span><br><span class="line">top_counts(width_heights_counts)</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">    <span class="number">7891</span></span><br><span class="line">    [(<span class="number">1751</span>, <span class="string">'5184_3456'</span>),</span><br><span class="line">     (<span class="number">1132</span>, <span class="string">'6000_4000'</span>),</span><br><span class="line">     (<span class="number">999</span>, <span class="string">'5472_3648'</span>),</span><br><span class="line">     (<span class="number">575</span>, <span class="string">'5760_3840'</span>),</span><br><span class="line">     (<span class="number">462</span>, <span class="string">'6016_4016'</span>),</span><br><span class="line">     (<span class="number">427</span>, <span class="string">'5616_3744'</span>),</span><br><span class="line">     (<span class="number">404</span>, <span class="string">'4896_3264'</span>),</span><br><span class="line">     (<span class="number">392</span>, <span class="string">'4928_3264'</span>),</span><br><span class="line">     (<span class="number">321</span>, <span class="string">'3264_2448'</span>),</span><br><span class="line">     (<span class="number">316</span>, <span class="string">'4288_2848'</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment">### top10 颜色</span></span><br><span class="line">```python</span><br><span class="line">colors = [p[<span class="string">'color'</span>] <span class="keyword">for</span> p <span class="keyword">in</span> photos <span class="keyword">if</span> <span class="string">'color'</span> <span class="keyword">in</span> p <span class="keyword">and</span> p[<span class="string">'color'</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>]</span><br><span class="line">colors_counts = get_counts(colors)</span><br><span class="line">print(len(colors_counts))</span><br><span class="line">top_counts(colors_counts)</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">    <span class="number">19434</span></span><br><span class="line">    [(<span class="number">119</span>, <span class="string">'#FFFFFF'</span>),</span><br><span class="line">     (<span class="number">73</span>, <span class="string">'#FEFEFE'</span>),</span><br><span class="line">     (<span class="number">45</span>, <span class="string">'#010101'</span>),</span><br><span class="line">     (<span class="number">42</span>, <span class="string">'#FCFCFC'</span>),</span><br><span class="line">     (<span class="number">41</span>, <span class="string">'#FDFDFD'</span>),</span><br><span class="line">     (<span class="number">41</span>, <span class="string">'#FBFBFB'</span>),</span><br><span class="line">     (<span class="number">29</span>, <span class="string">'#020202'</span>),</span><br><span class="line">     (<span class="number">28</span>, <span class="string">'#F9F9F9'</span>),</span><br><span class="line">     (<span class="number">24</span>, <span class="string">'#FAFAFA'</span>),</span><br><span class="line">     (<span class="number">22</span>, <span class="string">'#FEFEFD'</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment">### top10 每年照片总数</span></span><br><span class="line">```python</span><br><span class="line">created_ats = [ p[<span class="string">'created_at'</span>][:<span class="number">4</span>] <span class="keyword">for</span> p <span class="keyword">in</span> photos]</span><br><span class="line">created_ats_counts = get_counts(created_ats)</span><br><span class="line">top_counts(created_ats_counts)</span><br></pre></td></tr></table></figure>
<pre><code>[(12761, &apos;2016&apos;),
 (5467, &apos;2015&apos;),
 (2702, &apos;2017&apos;),
 (1498, &apos;2014&apos;),
 (220, &apos;2013&apos;)]
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dust8.github.io/blog/2017/01/19/slots/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dust8">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dust8 的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/19/slots/" itemprop="url">python __slots__</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-19T05:15:31+00:00">
                2017-01-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><p>最近写 <code>scrapy</code> 时发现，继承 <code>spider</code> 时重写 <code>__init__</code> 后设置属性，该属性无法访问，会引起 <code>AttributeError</code>。 以前也在一些 <code>orm</code> 包里重写<br><code>__init__</code> 时出现该问题。百度+谷歌后还是无果，也许我用的都是假的。翻翻源代码，发现 <code>__slots__</code> 比较可疑。</p>
<h1 id="官方文档翻译"><a href="#官方文档翻译" class="headerlink" title="官方文档翻译"></a>官方文档翻译</h1><h2 id="slots"><a href="#slots" class="headerlink" title="slots"></a><strong>slots</strong></h2><p>默认情况下，类的实例有一个储存属性的字典。该字典会消耗那些只有少量实例变量的对象的空间。<br>当创建大量实例时，空间消耗可能变得非常严重。     </p>
<p>可以通过在类的定义中，定义 <code>__slots__</code> 来覆盖默认值。<code>__slots__</code> 声明一个实例变量的序列，<br>并且为每个实例保留足够的空间来保存每个变量的值。因为 <code>__dict__</code> 不会为每一个实例创建，<br>所以可以节省空间。    </p>
<h3 id="object-slots"><a href="#object-slots" class="headerlink" title="object.slots"></a>object.<strong>slots</strong></h3><p>这个类变量声明是由实例变量名字组成的字符串，可迭代对象，或者字符串序列。<br><code>__slots__</code> 为已声明的变量预留空间，并阻止为每个实例自动创建 <code>__dict__</code> 和 <code>__weakref__</code>。</p>
<h3 id="使用-slots-时的注意事项"><a href="#使用-slots-时的注意事项" class="headerlink" title="使用 slots 时的注意事项"></a>使用 <strong>slots</strong> 时的注意事项</h3><ul>
<li>当从没有 <code>__slots__</code> 的类继承时，该类的 <code>__dict__</code> 属性将始终可访问，因此子类中的 <code>__slots__</code> 定义是无意义的。</li>
<li>如果没有 <code>__dict__</code> 变量，则不能为实例指定 <code>__slots__</code> 定义中未列出的新变量。 尝试分配到未列出的变量名称会引发 <code>AttributeError</code>。 如果需要动态分配新变量，则在 <code>__slots__</code> 声明中的字符串序列中添加 <code>__dict__</code>。</li>
<li>如果每个实例没有 <code>__weakref__</code> 变量，定义 <code>__slots__</code> 的类就不支持对其实例的弱引用。 如果需要弱引用支持，请在 <code>__slots__</code> 声明中的字符串序列中添加 <code>__weakref__</code>。</li>
<li><code>__slots__</code> 在类级别通过为每个变量名创建描述符（实现描述符）来实现。 因此，类属性不能用于为 <code>__slots__</code> 定义的实例变量设置默认值， 否则，类属性将覆盖描述符。</li>
<li><code>__slots__</code> 声明的操作仅限于定义它的类。 因此，子类将有一个 <code>__dict__</code> ，除非子类还定义 <code>__slots__</code>（其中只能包含任何其他 <code>slots</code> 的名字）。</li>
<li>如果一个类定义了一个在基类中定义的 <code>slots</code>，那么由基类 <code>slots</code> 定义的实例变量是不可访问的（除了直接从基类检索它的描述符）。 这使得程序的含义未定义。 将来，可能会添加一个检查来防止这种情况。</li>
<li>非空 <code>__slots__</code> 不适用于从“可变长度”内置类型（如 <code>int</code>，<code>bytes</code> 和 <code>tuple</code>）派生的类。</li>
<li>任何非字符串可迭代可以分配给 <code>__slots__</code>。 也可以使用映射, 然而，将来，可以对与每个键相对应的值分配特殊的含义。</li>
<li><code>__class__</code> 赋值只有当两个类都有相同的 <code>__slots__</code>是才有效。</li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p><code>__slots__</code> 有2大用途: 一个是节省空间（大量实例时才明显），另一个是加快操作实例的速度（官方没说）。至于本文开头说的问题，暂时还没想明白，以后补上。<br>好吧，最后发现是 <code>__init__</code> 写成 <code>__int__</code> 了，我也是醉了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dust8.github.io/blog/2017/01/06/chrome-goldfull/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dust8">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dust8 的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/06/chrome-goldfull/" itemprop="url">一个免登录展开稀土掘金文章全文的chrome插件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-06T05:15:31+00:00">
                2017-01-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>在资讯爆炸的时代,如何挑选有用的资讯就比较困难,所以有了不少筛选信息的网站.<br>在专注于编程方面的, 又比较活跃和大一些的就有 稀土掘金, 开发者头条 和 推酷.<br>前2者比较新比较活跃, 后者比较老.<br>这里要抱怨下常用的套路, 从免登录+无广告,用户多一点就要登录,到登录后要验证个人信息+加入广告.<br>我个人非常不喜欢这种要强制要登录的.我只是单纯的想看一下文章而已, 完全没必要去登录.<br>稀土掘金现在有些文章就需要登录才能展开全文, 所以就要想想办法,<br>开发了 <a href="https://github.com/dust8/goldfull" target="_blank" rel="noopener">gold full</a> 插件.</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>按照经验来说,一般全文都已经请求到客户端了,只是被隐藏了而已. 这样可以省去重复请求, 节约服务器资源.<br>先看网页源代码,完全没有数据.在审查元素, 可以看到全文都在里面,只是没有显示出来.    </p>
<p>分析它的 <code>展开全文</code> 按钮的 <code>js</code> 代码,发现自己太菜,看不懂.只好查看内容的 <code>css</code> 类名,<br>终于有所发现. 有个 <code>hidden</code> 类, 有 <code>overflow: hidden;position: relative;</code> 属性,<br>把 <code>overflow</code> 属性去掉之后就可以看到全文. 不过有个问题会出现和下面的元素内容重叠.<br>可以想到是高度问题,发现有个 <code>max-height</code>,把它去掉就完全没有问题了.</p>
<h2 id="开发插件"><a href="#开发插件" class="headerlink" title="开发插件"></a>开发插件</h2><p>每次都去改属性比较麻烦,可以做成插件,来自动完成.<br><a href="http://www.ituring.com.cn/book/1421" target="_blank" rel="noopener">Chrome扩展及应用开发</a><br><a href="https://developer.chrome.com/extensions" target="_blank" rel="noopener">What are extensions</a><br>有这本书和官方文档就可以开发插件了.<br><code>goldfull</code> 代码很简单,改了 <code>max-height</code> 为 <code>none</code>, 移除了 <code>展开全文</code> 按钮.</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>今天总算没有浪费在游戏上面,然后就是把知识用起来的感觉真好.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">dust8</p>
              <p class="site-description motion-element" itemprop="description">读书百遍其义自见</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">101</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">121</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/dust8" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.the5fire.com/" title="the5fire" target="_blank">the5fire</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2011 &mdash; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dust8</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>
  

  
  
    <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>
  

  
  
    <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.lazyload/1.9.3/jquery.lazyload.min.js"></script>
  

  
  
    <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script>
  

  
  
    <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script>
  

  
  
    <script type="text/javascript" src="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.pack.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
